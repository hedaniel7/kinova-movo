<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro" xmlns:drake="http://drake.mit.edu">

  <xacro:macro name="robotiq_85_gripper_transmission" params="prefix">

        <xacro:if value="$(optenv REPLACE_MIMIC false)">
          <transmission name="${prefix}gripper_finger1_trans">
              <type>transmission_interface/SimpleTransmission</type>
              <joint name="${prefix}gripper_finger1_inner_knuckle_joint">
                  <hardwareInterface>PositionJointInterface</hardwareInterface>
              </joint>
              <actuator name="${prefix}gripper_finger1_motor">
                  <mechanicalReduction>1</mechanicalReduction>
                  <hardwareInterface>PositionJointInterface</hardwareInterface>
              </actuator>
          </transmission>
          <transmission name="${prefix}gripper_finger2_trans">
              <type>transmission_interface/SimpleTransmission</type>
              <joint name="${prefix}gripper_finger2_inner_knuckle_joint">
                  <hardwareInterface>PositionJointInterface</hardwareInterface>
              </joint>
              <actuator name="${prefix}gripper_finger2_motor">
                  <mechanicalReduction>1</mechanicalReduction>
                  <hardwareInterface>PositionJointInterface</hardwareInterface>
              </actuator>
          </transmission>
        </xacro:if>
        <xacro:unless value="$(optenv REPLACE_MIMIC false)">
        <xacro:unless value="$(optenv WELD_FINGERS false)">
          <transmission name="${prefix}gripper_finger1_trans">
              <type>transmission_interface/SimpleTransmission</type>
              <joint name="${prefix}gripper_finger1_joint">
                  <hardwareInterface>PositionJointInterface</hardwareInterface>
              </joint>
              <actuator name="${prefix}gripper_finger1_motor">
                  <mechanicalReduction>1</mechanicalReduction>
                  <hardwareInterface>PositionJointInterface</hardwareInterface>
                  <!-- TODO(russt): Find real values for these numbers: -->
                  <drake:rotor_inertia value='1e-6' />
                  <drake:gear_ratio value='300' />
              </actuator>
          </transmission>
        </xacro:unless>
        </xacro:unless>

        <gazebo>
                <!-- loading plugin: mimic joints works in gazebo now -->
            <plugin filename="libroboticsgroup_gazebo_mimic_joint_plugin.so" name="${prefix}mimic_robotiq_85_1">
                <joint>${prefix}gripper_finger1_joint</joint>
                <mimicJoint>${prefix}gripper_finger2_joint</mimicJoint>
                <!--multiplier>1.0</multiplier>
                <offset>0.0</offset-->
            </plugin>
            <plugin filename="libroboticsgroup_gazebo_mimic_joint_plugin.so" name="${prefix}mimic_robotiq_85_2">
                <joint>${prefix}gripper_finger1_joint</joint>
                <mimicJoint>${prefix}gripper_finger2_inner_knuckle_joint</mimicJoint>
                <!--multiplier>1.0</multiplier>
                <offset>0.0</offset-->
            </plugin>
            <plugin filename="libroboticsgroup_gazebo_mimic_joint_plugin.so" name="${prefix}mimic_robotiq_85_3">
                <joint>${prefix}gripper_finger1_joint</joint>
                <mimicJoint>${prefix}gripper_finger1_inner_knuckle_joint</mimicJoint>
                <!--multiplier>1.0</multiplier>
                <offset>0.0</offset-->
            </plugin>
            <plugin filename="libroboticsgroup_gazebo_mimic_joint_plugin.so" name="${prefix}mimic_robotiq_85_4">
                <joint>${prefix}gripper_finger1_joint</joint>
                <mimicJoint>${prefix}gripper_finger1_finger_tip_joint</mimicJoint>
                <multiplier>-1.0</multiplier>
                <offset>0.0</offset>
            </plugin>
            <plugin filename="libroboticsgroup_gazebo_mimic_joint_plugin.so" name="${prefix}mimic_robotiq_85_5">
                <joint>${prefix}gripper_finger1_joint</joint>
                <mimicJoint>${prefix}gripper_finger2_finger_tip_joint</mimicJoint>
                <multiplier>-1.0</multiplier>
                <offset>0.0</offset>
            </plugin>
        </gazebo>

    </xacro:macro>

</robot>
